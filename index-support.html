<!DOCTYPE html>
<html>
<head>
	
	<title>talk with strangers</title>
	    <!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

	<!-- FONT AWESOME -->
	<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>
 
 	<link rel="shortcut icon" type=" " href="favicon.png"/>
	<link rel="shortcut icon" type=" " href="/favicon.png"/>
	<link rel="stylesheet" href="/style/style.css">

	<!-- <style type="text/css">
		html, body
	{
		height: 100%;
		background-color: #e3e3e3
	}
	
	.mainWeb {
	background-color: #1090EE;
	}
	
	.primary{
		color: #fff;
		background-color: #1090EE;
		
	}
	a.noStyleAtag{
		color:white;
	}
	
	@media (min-width: 1281px) {
	  
		#chat_component_father{
		  height: 98%;
	  }
	}
	
	@media (min-width: 1025px) and (max-width: 1280px) {
		#chat_component_father{
		  height: 98%;
	  }
	  
	}
	
	@media (min-width: 768px) and (max-width: 1024px) {
		#chat_component_father{
		  height: 98%;
	  }
	  
	}
	
	@media (min-width: 768px) and (max-width: 1024px) and (orientation: landscape) {
		#chat_component_father{
		  height: 98%;
	  }
	}
	
	@media (min-width: 481px) and (max-width: 767px) {
		.titleAbout {
		font-size: 17px;
	 }
	  
	  #chat_component_father{
		  height: 91%;
	  }
	}
	 /* 
	##Device = Most of the Smartphones Mobiles (Portrait)
	##Screen = B/w 320px to 479px
	*/
	
	@media (min-width: 320px) and (max-width: 480px) {
		.titleAbout {
			font-size: 20px;
	
	 }
		#chat_component_father{
		  height: 89%;
	  }
	}
	
	
	
	@media   (max-height: 640px)  {
	
	#chat_component_father{
	  height:64%;
	}
	}
	
	 
	
	
	.footer {
	   position: static; 
	   width: 100%;
	   background-color: #fff;
	   color: black;
	   font-size: 12px;
	   text-align: center;
	}
	 
	</style> -->
</head>
<body>

 
<section>
<nav class="navbar sticky-top navbar-light  mainWeb"  >
  <a class="navbar-brand noStyleAtag " href="">
  	<img src="/logo1.png" style="width: 50px">
  </a>
  <a class="navbar-brand text-white noStyleAtag" ><strong>Stay Home, Stay Safe !
</strong></a>

</nav>

</section>

 <!-- OLD ONE 200PX -->
<section id="index_section" class="tg"  style="min-height: calc(100% - 170px);"  >
	
	<div class="container">
			
					<div>
						<div class="text-center">
							<img src="/logo2.png" class="col-6 col-md-3" alt="">
							</div>
							<h3 class="text-center titleAbout">The First Tunisian Chat website
							</h3>
		 						<div class="text-justify text-center">
 				 
					</div>
				
						<div class="text-center ">
							<label>Enter information about you :</label>
							<div class="row justify-content-md-center">
								<input id="myName" type="text" name="name" class="form-control col-12 col-md-6 " placeholder="Name">
							 
							</div>
							<label for="age">Enter your age :</label>
							<div class="row justify-content-md-center ">
									<input id="age" type="number" name="age" class="form-control  offset-3 offset-md-0 col-6 col-md-2 " placeholder="Age" min='10' >
						 	</div>
 
							<label for="sex">Enter your gender :</label>
							<div class="row justify-content-md-center offset-5 offset-md-0">
								 
									<div class="mr-2 ">
										<label for=""><i class="fas fa-male" style="font-size: 30px;color: blue;"></i></label>
										<input type="checkbox" name="sex" value="male">
									</div>
									<div class="ml-2">
										<label for=""><i class="fas fa-female" style="font-size: 30px;color:pink"></i></label>
										<input type="checkbox" name="sex" value="female">
									</div>
									 
 							</div>

 	 					</div>

	 						<div class="text-center m-2">
								<a class="btn primary text-white"  onClick="startChating()">START CHAT</a>
 	 		
							</div>

				</div>

	</div>

 


   
 
</section> 

<!-- the OLD ONE WAS HERE -->
<!-- 	<div class="footer-copyright text-center  StartChattingHide " style="bottom: 0px;position: static;"> <a href="#" data-toggle="modal" data-target="#exampleModal">Contact us</a> </div>
 -->
<!--  -->
<div  class=" mt-4 StartChattingHide ">

	<div class="footer "  >
		<footer class="page-footer font-small blue " >
			<div class=" ">
				<div class="footer-copyright text-center py-3"><p class=" ">
		By pressing "Start Chat" you agree with our  
		<span>
			<a href="/terms" style="text-decoration-line: underline;">Terms of service</a> - <a href="#" data-toggle="modal" data-target="#exampleModal">Contact us</a> 
		</span>

	</p> </div>

			</div>

		</footer>
	 </div>
</div>
 



	<!-- MODAL -->
 
	  
	  <!-- Modal -->
	  <div class="modal fade " id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
		  <div class="modal-content " style="width: 97%;">
			<div class="modal-header primary">
			  <h5 class="modal-title" id="exampleModalLabel">Contacts</h5>
			  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			  </button>
			</div>
			<div class="modal-body">
				<p>Email: Support@unicaly.com </p>
 	
			
			</div>
			<div class="modal-footer">
			  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
 			</div>
		  </div>
		</div>
	  </div>

	  <!-- MODAL -->




	  <!-- Modal -->
	  <div class="modal fade msgFromAdmin " id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
		  <div class="modal-content " style="width: 97%;">
			<div class="modal-header primary">
			  <h5 class="modal-title" id="exampleModalLabel">Message from Admin</h5>
			  <button type="button" class="close closeMessageFromAdmin" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			  </button>
			</div>
			<div class="modal-body ">
				<p id="messageFromAdmin"></p>
				<button class="btn btn-danger closeMessageFromAdmin" data-dismiss="modal">Ok</button>

			</div>
			<div class="modal-footer">
			  <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
 			</div>
		  </div>
		</div>
	  </div>

	  <!-- MODAL -->




	  <!-- Modal -->
	  <div class="modal fade requestConnection " id="requestConnection" tabindex="-1" role="dialog" aria-labelledby="requestConnection" aria-hidden="true">
		<div class="modal-dialog" role="document">
		  <div class="modal-content " style="width: 97%;">
			<div class="modal-header primary">
			  <h5 class="modal-title" id="requestConnectionTitle">request from user</h5>
			  <button type="button" class="close closeMessageFromAdmin" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			  </button>
			</div>
			<div class="modal-body ">
				<p id="requestConnectionMessage"></p>
				<i>be aware, if you accept the request, you will be disconected from this conversation </i>

			</div>
			<div class="modal-footer">
				<button class="btn btn-success closeMessageFromAdmin" data-dismiss="modal" onclick="acceptChatConnection()">accept</button>
				<button class="btn btn-danger closeMessageFromAdmin" data-dismiss="modal" onclick="cancleChatConnection()">cancle</button>

			  <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
 			</div>
		  </div>
		</div>
	  </div>

	  <!-- MODAL -->






	<div id="chat_section" class="container" style="display: none ;height:100%; ">


	<section  style="background-color: #f5f5f5;height:80%; " class="">
		<div class="row mt-1 ">

			<div  class="col-3 col-md-6  text-left "> <a href=""  class="btn primary " onclick="return confirm('Are you sure you want to leave ?')"  ><i class="fas fa-backward "></i> </a></div>
			<div  class="col-9  col-md-6  text-right"><a href="#" class="" >  
                <a id="chatWithAdmin" href="#" class="text-light p-1" style="direction: unset;cursor:default"> <span  class="badge bg-secondary ">Admin is offline</span>  </a>
				<a id="volume" class="btn btn-success text-white " onclick="mute()"><i class="fas fa-volume-up"></i></a> 
				<a class="btn primary next"> <i class="fas fa-arrow-circle-right text-light  p-1" ></i> </a> 
            </div>

            
		</div>

		<div class="m-4 p-2" style="  height: 90%; " >
 
				<div class="chat  " style="  height: 90%; "  style="background-color: #f5f5f5" >
 			
					<div class="mt-1">
							<p id='connection_message'><em>looking for someone to chat with</em></p>
 					</div>
		
		
						<div id="chat_component_father"  style="background-color: #f5f5f5;  ;">

							<div id="chat_component_p" style="background-color: #f5f5f5; max-height:95%;overflow: auto;">


									<div  id="chat_component">

									</div>
									<div id="userTyping"  style="display: none;">
										<p><em>user is typing....</em></p>
									</div>

									<div id="" style="display: none;" class="tryAgain">
										<p><em>This stranger has disconected</em></p>
										<button   class="btn primary startAgain">
											Start Again
										</button>
									</div>
							</div>
							
						


							

							
						</div>
				
					
			

				</div>



		</div>



	</section>
	<section class="mt-2" >
		
		<div class="mt-1" style=" bottom: 0;"  >
	
			<div class="row" > 			
					<!-- INPUT SEND -->

					<div class=" col-6 col-md-8  ">
							<div class="form-group">
								<input  readonly id="messageContent" type="text" name="msg" class="form-control" style="height: 50px">
							</div>
					</div>
					<!-- BUTTON SEND -->
					<div class="  col-3 col-md-2 ">
						<div class="form-group ">
							<button  id="sendMessage"  disabled  class="form-control btn  primary   " style="height: 50px"  ><i class="fas fa-paper-plane" style="padding-top: 10px;"></i></button>

						</div>
					</div>	
					<div class="  col-3  col-md-2 ">
						<div class="form-group  ">
							<button disabled  id="fileUpload" onClick="$('#sendFile').trigger( 'click' )"  class="form-control btn   btn-secondary   " style="height: 50px"  ><i class="fas fa-camera" style="padding-top: 10px;"></i></button>
							<input accept=".jpg" href="" id="sendFile" type="file"   class=" hide " style="height: 50px;  display: none;"  value="Upload"  >

						</div>
					</div>
								
			</div>

					
		</div>
	</section>

</div>



<audio id="newUserSound"  class="hide">
	<source src="/sound/new-user.ogg" type="audio/ogg">
   Your browser does not support the audio element.
  </audio>


  <audio id="newMessageSound"  class="hide"  >
	<source src="/sound/new-message.ogg" type="audio/ogg">
   Your browser does not support the audio element.
  </audio>

<script src="/scripts/functions.js" > </script>
<script src="/socket.io/socket.io.js"></script>
<script>
	  var socket = io.connect();
	  let stranger_name;
	  let stranger_sex;
	  let stranger_age;
 	  let room;
	  let name=null;
	  let sex=null;
	  let age = null;
	  let timeout;
	  socket.on('connect',()=>{
 	  })
		socket.on("joinRoom",(data)=>{
 
			stranger_name = data.name;
			stranger_age = data.age;
			stranger_sex = data.sex;
			room = data.room;
			socket.emit("joinChatRoom",{room:data.room});


		});

	// var signalingArea = document.querySelector("#signalingArea");
			let sendFile = document.querySelector("input#sendFile");
			let fileProgress = document.querySelector("progress#fileProgress");
			let downloadLink = document.querySelector('a#receivedFileLink');
	 
			let keyUp=true;
			let configuration = {
				'iceServers': [{
					'url': 'stun:stun.l.google.com:19302'
				}]
			};
			let rtcPeerConn;
			let dataChannelOptions = {
				ordered: false, //no guaranteed delivery, unreliable but faster 
				maxRetransmitTime: 1000, //milliseconds
			};
			let dataChannel;

			let receivedFileName;
			let receivedFileSize;
			let fileBuffer = [];
			let fileSize = 0;
			let adminOnline=false;




 
</script>

<script src="/scripts/messages.js"></script>

<!-- FILE SHARE  -->
<script src="/scripts/files-sender.js"> </script>
</body>
</html>
<!-- BY MOHAMAD AL ASALY -->


<script>


    $("#chatWithAdmin").click(function(){
		if(adminOnline){
			var chatWithAdmin = confirm("do you want to chat with the admin?");
			if(chatWithAdmin){
		

				disconnectingWebRTC();
				stranger_name=null;
				room='';
				setSendMessageToDisable();
				setSendFileToDisable();
				socket.emit("joinAdminQueue",{name:name,age:age,sex:sex});
				
				$("#connection_message").html("<b class='text-danger'>you are standing on the line to chat with the admin, please wait<b>");
				$(".tryAgain").hide();
				$("#chat_component").html('');
				$("#userTyping").hide();


		}

		}
	
	 })
	 
	 socket.on('adminStatus',(data)=>{
		 if(data>0){
			$(".badge").removeClass("bg-secondary").addClass("bg-success").html('Admin is online').parent().css("cursor",'pointer');
			adminOnline=true;
		 }else{
			$(".badge").removeClass("bg-success").addClass("bg-secondary").html('Admin is offline').parent().css("cursor",'default');
			adminOnline=false;
		 }
	 })

	 socket.on("adminJoin",()=>{
			$(".badge").removeClass("bg-secondary").addClass("bg-success").html('Admin is online').parent().css("cursor",'pointer');
			adminOnline=true;
	 });
	 socket.on("adminOut",()=>{
			$(".badge").removeClass("bg-success").addClass("bg-secondary").html('Admin is offline').parent().css("cursor",'default');
			adminOnline=false;
	 });
	 
	 socket.on("ban",(data)=>{
		  let msg = data.msg;
 
			$(".msgFromAdmin").modal()
			$("#messageFromAdmin").html(msg);

			$(".closeMessageFromAdmin").click(function(){
						 	window.location.href='/not-allowed';

			})
 
 
	})

	socket.on("alert",(data)=>{
		let msg = data.msg;
 
		$(".msgFromAdmin").modal()
		$("#messageFromAdmin").html(msg);

		});



if(!localStorage.getItem('MyId')){
localStorage.setItem('MyId',parseInt(Math.random()*1000000000000000000));
} 
		


socket.on("requestConnection",(data)=>{
	$(".requestConnection").modal();
	$("#requestConnectionMessage").html(`user <b>${data.name}</b> want to chat with you`);

})


function mute(){

 	if($("#newMessageSound").prop('muted')==true){
		 
		$("#newMessageSound").prop('muted',false);
		$("#volume").html('<i class="fas fa-volume-up"></i>');
		
	}else if($("#newMessageSound").prop('muted')==false){
	 
		$("#newMessageSound").prop('muted',true);
		$("#volume").html('<i class="fas fa-volume-mute"></i>');
	}
  }


 function acceptChatConnection(){
	 socket.emit("acceptConnectionWithUser");
 }

 function cancleChatConnection(){
	 socket.emit('cancleConnectionWithUser');
 }
</script>