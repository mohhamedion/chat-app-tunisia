<!DOCTYPE html>
<html>
<head>
	
	<title>talk with strangers</title>
	    <!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

	<!-- FONT AWESOME -->
	<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous"/>

	<style type="text/css">
	html, body
{
    height: 100%;
    background-color: #FFF7EE
}

.mainWeb {
background-color: #c63f41;
}
</style>
</head>
<body>



<section>
<nav class="navbar sticky-top navbar-light  mainWeb"  >
  <a class="navbar-brand text-primary" href="#">
  	<img src="https://pngimage.net/wp-content/uploads/2018/06/logo-chat-png-3.png" style="width: 60px">
  </a>

  <a class="navbar-brand text-white   " ><strong> 3000 now online</strong></a>

 </nav>

</section>

 
<section id="index_section"  >
	
	<div class="container">
			
				<div>
					<h1 class="text-center">welcome to chat with stranger</h1>
					<div class="text-justify">
					 	Left aligned text on viewports sized SM (small) or wider.
					 	Left aligned text on viewports sized SM (small) or wider.
					 	Left aligned text on viewports sized SM (small) or wider.
					 	Left aligned text on viewports sized SM (small) or wider.
					 	Left aligned text on viewports sized SM (small) or wider.
					 	Left aligned text on viewports sized SM (small) or wider.
					 	Left aligned text on viewports sized SM (small) or wider.
					 	Left aligned text on viewports sized SM (small) or wider.
					 	Left aligned text on viewports sized SM (small) or wider.
 
					</div>
				
						<div class="text-center">
							<label>Enter your name</label>
	 							<input id="myName" type="text" name="name" class="form-control">
	 					</div>

	 						<div class="text-center m-1">
							<a class="btn btn-primary text-white"  onClick="startChating()">START CHAT WITH STRANGER</a>

 					</div>

				</div>

	</div>

</section>

<div id="chat_section" class="container" style="height: 80%;background-color: #fff;display: none;">


<section >
	

	<div class="m-4 p-2"  >
	

		<div class="row">
			<div class="col-6 text-left"> <a href=""class="btn btn-primary"  ><i class="fas fa-backward"></i> </a></div>
	 
			<div class="col-6 text-right"><a href="#" class="btn btn-primary startAgain" ><i class="fas fa-arrow-circle-right"></i> </a> </div>
		</div>

			<div class="chat  " style=" height: 90%; "  style="background-color: #fff" >
				
				<div class="mt-1">
						<p id='connection_message'><em>looking for someone to chat with</em></p>

				</div>
	
	 
					<div id="chat_component_p"  style="background-color: #fff;max-height:450px;overflow: auto;">

						<div id="chat_component">

						</div>
					
						<div id="" style="display: none;" class="tryAgain">
							<p><em>This stranger has disconected</em></p>
							<button   class="btn btn-primary startAgain">
								Start Again
							</button>
						</div>
					</div>
			
				
		

			</div>



	</div>



</section>
<section>
	
	<div class="fixed-bottom  " style="background-color: #FFF7EE;">
 
		<div class="row  pt-2"> 			
			     <!-- INPUT SEND -->

				<div class=" col-10 ">
						<div class="form-group">
							<input id="messageContent" type="text" name="msg" class="form-control" style="height: 50px">
						</div>
				</div>
				<!-- BUTTON SEND -->
				<div class="  col-2">
					<div class="form-group">
						<a href="#" id="sendMessage" type="" name="msg" class="form-control btn btn-primary text-white" style="height: 50px"  >Send</a>

					</div>

				</div>	

		 </div>

				
 	</div>
</section>

</div>




<!-- <section>
	
	<div class="fixed-bottom">
	 
		<footer>
			<div class="card text-center">
  <h5 class="card-header">Featured</h5>
  <div class="card-body">
      <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>

  </div>
</div>
		</footer>

	</div>
</section> -->



<script>
	function myMessage(msg){
		$("#chat_component").append("<div><span class=''> <span style='color: red'>you</span>: "+msg+"</span></div>");

	}

	function hisMessage(msg,name){
		$("#chat_component").append("<div> <span class=''> <span style='color: blue'>"+name+"</span>: "+msg+"</span></div>");

	}
</script>
<script src="/socket.io/socket.io.js"></script>
<script>
	  var socket = io.connect();
	  let stranger_name;
	  let room;
	  let name;
	  socket.on('connect',()=>{
		  console.log(socket.id)
	  })
		socket.on("joinRoom",(data)=>{
			console.log(data.room);
			stranger_name = data.name;
			room = data.room;
			socket.emit("joinChatRoom",{room:data.room});
		});


		socket.on("connected",()=>{
			console.log("both are connected");
			$("#connection_message").html("you are chatting now with a stranger, say hi to "+stranger_name);
			



			$("#messageContent").keypress(function(event){
				
			var keycode = (event.keyCode ? event.keyCode : event.which);
			if(keycode == '13'){
				
				if($("#messageContent").val()!==""){
					socket.emit("messageToServer",{message:$("#messageContent").val(),room:room,id:socket.id});
				$("#messageContent").val('');
				}
				
			}

			});

			$("#sendMessage").click(function(){
				if($("#messageContent").val()!==""){
					socket.emit("messageToServer",{message:$("#messageContent").val(),room:room,id:socket.id});
				$("#messageContent").val('');
				}
			
			})
		
		})
	

		socket.on("messageToClient",(data)=>{

			if(data.id==socket.id){
				myMessage(data.message);
			}else{
				hisMessage(data.message,stranger_name);
			}
		
			$('#chat_component_p').scrollTop($('#chat_component_p')[0].scrollHeight);

		})


		socket.on("getOut",(data)=>{
		 $(".tryAgain").show();
 			stranger_name='';
			room='';
			$('#chat_component_p').scrollTop($('#chat_component_p')[0].scrollHeight);

		})

	 

		$(".startAgain").click(function(){

			$("#connection_message").html("looking for someone to chat with");
			$(".tryAgain").hide();
			$("#chat_component").html('');
			console.log('start again');

			console.log(name);
			console.log(socket.id);
			socket.emit("queue",{name:name,id:socket.id});

		})



	function startChating(){
				
				 name =  $("#myName").val();

				if(name==""){
					alert('enter your name');
					return false;
				} 
	
				
				$("#index_section").hide();
				$("#chat_section").animate({width:'toggle'},500);

				socket.emit("queue",{name:name,id:socket.id});
				console.log(name);
				console.log(socket.id)

	
	}


	$("#myName").keypress(function(event){
				
				var keycode = (event.keyCode ? event.keyCode : event.which);
				if(keycode == '13'){
					
					startChating();
					
				}
	
				});
</script>
</body>
</html>
<!-- BY MOHAMAD AL ASALY -->